<html>
	<head>
		<title>{{ config['core']['title'] }}</title>
		<script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
		<link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css">
		<script src="//netdna.bootstrapcdn.com/bootstrap/3.0.0/js/bootstrap.min.js"></script>
	</head>
	<body>
		<div class="jumbotron">
			<div class="container">
				<h1>Test page</h1>
			</div>
		</div>
		<canvas id="vnc" width="1024" height="768">Your web browser does not support HTML5 Canvas. Please upgrade to a more modern web browser.</canvas>
		<script>
			// global variables
			var ws = new WebSocket({{ "'ws://" + config['websockets']['site'] + ':' + config['websockets']['port'] + config['websockets']['url'] + "'" }});
			var cv = document.getElementById('vnc');
			var ct = cv.getContext('2d');

			
			// Websocket handler functions
			ws.onopen = function() {
				console.log("Websocket opened.");
				//ws.binaryType = "arraybuffer";
			};

			ws.onmessage = function(ev) {
				var img = new Image();
				//console.log("Message received: " + ev.data);
				img.src = "data:image/png;base64," + ev.data;
				ct.drawImage(img,0,0);
			};

			ws.onclose = function(ev) {
				console.log("Websocket closed: " + ev.data);
			};

			ws.onerror = function(ev) {
				console.log("Error received:   " + ev.data);
			};

			
			// Canvas event binds
			$('#vnc').mousemove(function(event) {
				var msg = "mouse_move " + event.pageX + ' ' + event.pageY;
				ws.send(msg);
			});

			$('#vnc').mousedown(function(event) {
				var msg = "mouse_down " + event.pageX + " " + event.pageY;
				ws.send(msg);
			});

			$('#vnc').mouseup(function(event) {
				var msg = "mouse_up " + event.pageX + " " + event.pageY;
				ws.send(msg);
			});

			$('#vnc').keydown(function(event) {
				var msg = "key_down " + event.charCode;
				ws.send(msg);
			});

			$('#vnc').keyup(function(event) {
				var msg = "key_up " + event.charCode;
				ws.send(msg);
			});

			
			// Debugging code
			console.log(ws.binaryType);
		</script>
	</body>
</html>
